### 10 差异表达基因韦恩图绘制



```r
#设置后续目录
setwd("workdir/")

install.packages("VennDiagram")
install.packages("ggVennDiagram")

library(VennDiagram)
library(RColorBrewer)
library(ggVennDiagram)
library(RColorBrewer)
library(tidyverse)

```



导入所有的差异表达分析结果

```{r}



de_result <- read_delim("5DESeq2/de_result.tsv", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE)
# 去除无用的列
select(de_result, gene_id, sampleA, sampleB, log2FoldChange, padj) %>%
  # 添加 direction 列
  mutate(direction = if_else(abs(log2FoldChange) < 1 | padj > 0.05, 'ns', 
                             if_else(log2FoldChange >= 1, 'up', 'down'))) -> de_result



```



### 

上下调基因数目统计

```{r}
de_result_updowncount= filter(de_result, direction != 'ns') %>%
  group_by(sampleA, sampleB, direction) %>%
  summarise(count = n())

write_csv(de_result_updowncount, "6venn/de_result_updowncount.csv")
```

差异基因的韦恩图

```{r}
###五个以下的韦恩图
de_list = list(
    ZT1 = filter(de_result, sampleA == "ZT1", sampleB == "ZT0", direction != 'ns') %>% pull(gene_id),
    ZT4 = filter(de_result, sampleA == "ZT4", sampleB == "ZT1", direction != 'ns') %>% pull(gene_id),
    ZT8 = filter(de_result, sampleA == "ZT8", sampleB == "ZT4", direction != 'ns') %>% pull(gene_id),
    ZT16 = filter(de_result, sampleA == "ZT16", sampleB == "ZT12", direction != 'ns') %>% pull(gene_id),
    ZT20 = filter(de_result, sampleA == "ZT20", sampleB == "ZT16", direction != 'ns') %>% pull(gene_id))


#准备颜色
RColorBrewer::brewer.pal(5, name = "Set1")
venn.diagram(
  x = de_list,
  filename = "6venn/de_venn.tiff",
  fill = RColorBrewer::brewer.pal(5, name = "Set1")
  )





###五个以上的韦恩图
de_list = list(
    ZT1 = filter(de_result, sampleA == "ZT1", sampleB == "ZT0", direction != 'ns') %>% pull(gene_id),
    ZT4 = filter(de_result, sampleA == "ZT4", sampleB == "ZT1", direction != 'ns') %>% pull(gene_id),
    ZT8 = filter(de_result, sampleA == "ZT8", sampleB == "ZT4", direction != 'ns') %>% pull(gene_id),
    ZT12 = filter(de_result, sampleA == "ZT12", sampleB == "ZT8", direction != 'ns') %>% pull(gene_id),
    ZT16 = filter(de_result, sampleA == "ZT16", sampleB == "ZT12", direction != 'ns') %>% pull(gene_id),
    ZT20 = filter(de_result, sampleA == "ZT20", sampleB == "ZT16", direction != 'ns') %>% pull(gene_id))



###软件默认绘图颜色

venn = Venn(de_list)
data = process_data(venn, shape_id = "601")
plot <- plot_venn(data)
print(plot)
ggsave(
  filename = "6venn/de_venn_6A.pdf",
  plot = plot,
  device = "pdf",
  width = 10,      # 宽度（英寸）
  height = 8,      # 高度（英寸）
  dpi = 300
)

### 自定义颜色
# 获取9种颜色
colors <- brewer.pal(9, name = "YlGnBu")
# 创建Venn对象并处理数据
venn <- Venn(de_list)
data <- process_data(venn, shape_id = "601")
# 绘制韦恩图并使用指定的颜色
plot <- plot_venn(data) +
scale_fill_gradientn(colours = colors)# +
#  theme(legend.position = "none")  # 如果需要移除图例
print(plot)


ggsave(
  filename = "6venn/de_venn_6B.pdf",
  plot = plot,
  device = "pdf",
  width = 10,      # 宽度（英寸）
  height = 8,      # 高度（英寸）
  dpi = 300
)

```

